---
layout:     post
title:      How-to： Analyze Twitter Data with Hue
subtitle:   转载自：http://blog.cloudera.com/blog/2013/03/how-to-analyze-twitter-data-with-hue/
date:       2013-03-25
author:     Romain Rigaux
header-img: img/background3.jpg
catalog: true
tags:
    - hive
    - string
    - hue
    - query
    - queries
---

[Hue 2.2](http://blog.cloudera.com/blog/2013/03/whats-new-in-hue-2-2) , the open source web-based interface that makes [Apache Hadoop](http://hadoop.apache.org/) easier to use, lets you interact with Hadoop services from within your browser without having to go to a command-line interface. It features different applications like an Apache Hive editor and Apache Oozie dashboard and [workflow builder](http://blog.cloudera.com/blog/2013/01/dynamic-workflow-builder-in-hue).

This post is based on our “[Analyzing Twitter Data with Hadoop](http://blog.cloudera.com/blog/2012/11/analyzing-twitter-data-with-hadoop-part-3-querying-semi-structured-data-with-hive)” sample app and details how the same results can be achieved through Hue in a simpler way. Moreover, all the [code and examples](https://github.com/romainr/cdh-twitter-example) of the previous series have been updated to the recent [CDH4.2](http://blog.cloudera.com/blog/2013/02/new-products-releases) release.

## Collecting Data

The first step is to create the “flume” user and his home on the HDFS where the data will be stored. This can be done via the User Admin application.

[![](http://blog.cloudera.com/wp-content/uploads/2013/03/hue1.png)
](http://blog.cloudera.com/wp-content/uploads/2013/03/hue1.png)

The second step consists of collecting some tweet data from the live Twitter stream.

[Apache Flume](http://flume.apache.org/) is an elegant solution for taking care of this. The configuration of Flume is detailed in the [readme](https://github.com/romainr/cdh-twitter-example#configuring-flume) and previous blog [post](http://blog.cloudera.com/blog/2012/09/analyzing-twitter-data-with-hadoop). However, if you want to skip this step, some data is available on [GitHub](https://github.com/romainr/cdh-twitter-example/blob/master/hue/tweets.zip). Just upload it as a zip file in the home directory of the flume user and the “tweets” directory will show up after a few seconds.

If you are not taking this shortcut, create the tweets directory in the File Browser with the New Folder action.

[![](http://blog.cloudera.com/wp-content/uploads/2013/03/hue2.png)
](http://blog.cloudera.com/wp-content/uploads/2013/03/hue2.png)

Then, when the Flume agent is [started](https://github.com/romainr/cdh-twitter-example#starting-the-data-pipeline), the data will start appearing:

[![](http://blog.cloudera.com/wp-content/uploads/2013/03/hue3.png)
](http://blog.cloudera.com/wp-content/uploads/2013/03/hue3.png)

Clicking on a file will display its content in the built-in viewer:

[![](http://blog.cloudera.com/wp-content/uploads/2013/03/hue4.png)
](http://blog.cloudera.com/wp-content/uploads/2013/03/hue4.png)

## Preparing Hive

It is time to prepare the analysis of the tweet data. We’ll use Apache Hive, which can query the data with SQL-like syntax in a scalable way. The detailed description of the Hive setup is detailed in the [readme](https://github.com/romainr/cdh-twitter-example#setting-up-hive).

When Hive is ready, the tweet table can be created in the query editor of Beeswax. Notice that the Hive SerDe (to download or compile [here](https://github.com/romainr/cdh-twitter-example#setting-up-hive)) must be included as a jar in the query. You can read more about Hive SerDe in this previous [post](http://blog.cloudera.com/blog/2012/12/how-to-use-a-serde-in-apache-hive).

To do this, just click on “Add” > “File Resources”, click on the path chooser button, click on the “Home” button, and upload hive-serdes-1.0-SNAPSHOT.jar.

[![](http://blog.cloudera.com/wp-content/uploads/2013/03/hue5.png)
](http://blog.cloudera.com/wp-content/uploads/2013/03/hue5.png)

Then just enter the `CREATE TABLE` statement and execute it:







|1234567891011121314151617181920212223242526272829|CREATE EXTERNAL TABLE tweets (  id BIGINT,  created_at STRING,  source STRING,  favorited BOOLEAN,  retweet_count INT,  retweeted_status STRUCT<    text:STRING,    user:STRUCT<screen_name:STRING,name:STRING>>,  entities STRUCT<    urls:ARRAY<STRUCT<expanded_url:STRING>>,    user_mentions:ARRAY<STRUCT<screen_name:STRING,name:STRING>>,    hashtags:ARRAY<STRUCT<text:STRING>>>,   text STRING,  user STRUCT<    screen_name:STRING,    name:STRING,    friends_count:INT,    followers_count:INT,    statuses_count:INT,    verified:BOOLEAN,    utc_offset:INT,    time_zone:STRING>,  in_reply_to_screen_name STRING) PARTITIONED BY (datehour INT)ROW FORMAT SERDE 'com.cloudera.hive.serde.JSONSerDe'LOCATION '/user/flume/tweets'|

2

4

6

8

10

12

14

16

18

20

22

24

26

28

  id BIGINT,

  source STRING,

  retweet_count INT,

    text:STRING,

  entities STRUCT<

    user_mentions:ARRAY<STRUCT<screen_name:STRING,name:STRING>>,

 

  user STRUCT<

    name:STRING,

    followers_count:INT,

    verified:BOOLEAN,

    time_zone:STRING>,

) 

ROW FORMAT SERDE 'com.cloudera.hive.serde.JSONSerDe'


 

Now that the table is created, let’s insert some data in the table. First, select the table in the “Table” tab and click “Import data”. Enter the path “/user/flume/tweets/2013/02/25/17” and “201302251” as the key:

[![](http://blog.cloudera.com/wp-content/uploads/2013/03/hue6.png)
](http://blog.cloudera.com/wp-content/uploads/2013/03/hue6.png)

Depending on the partition picked, a query similar to this will be generated:







||LOAD DATA INPATH '/user/flume/tweets/2013/02/25/16'INTO TABLE `default.tweets`PARTITION (datehour='2013022516')|

INTO TABLE `default.tweets`


 

After the query executes, the table ‘tweets’ will be available.

[![](http://blog.cloudera.com/wp-content/uploads/2013/03/hue7.png)
](http://blog.cloudera.com/wp-content/uploads/2013/03/hue7.png)

Beeswax can access the Hive metastore and its list of tables. A description of their schema and partitions with some example of data contained in each table are helpful while designing your queries. Moreover, a wizard can guide you step-by-step to create new tables.

[![](http://blog.cloudera.com/wp-content/uploads/2013/03/hue8.png)
](http://blog.cloudera.com/wp-content/uploads/2013/03/hue8.png)

##  

## Analysis with Beeswax

It becomes now possible to perform some `SELECT` queries on the data. Here is an example below but most of interesting ones are described in Parts [1](http://blog.cloudera.com/blog/2012/09/analyzing-twitter-data-with-hadoop) and [3](http://blog.cloudera.com/blog/2012/11/analyzing-twitter-data-with-hadoop-part-3-querying-semi-structured-data-with-hive) of the “Analyzing Twitter with Hadoop” series.







||SELECT    t.retweeted_screen_name,    sum(retweets) AS total_retweets,    count(*) AS tweet_count  FROM (SELECT          retweeted_status.user.screen_name as retweeted_screen_name,              retweeted_status.text,              max(retweet_count) as retweets        FROM tweets        GROUP BY retweeted_status.user.screen_name,                 retweeted_status.text) t  GROUP BY t.retweeted_screen_name  ORDER BY total_retweets DESC  LIMIT 10;|

    t.retweeted_screen_name,

    count(*) AS tweet_count

          retweeted_status.user.screen_name as retweeted_screen_name,

              max(retweet_count) as retweets

        GROUP BY retweeted_status.user.screen_name,

  GROUP BY t.retweeted_screen_name

  LIMIT 10;


 

Beeswax possesses multiple features for providing a better user experience than the command line shell. For example you can save queries and share them with other users. The result of a query can be exported into a new table or an HDFS file or downloaded to your desktop. Some other good examples are:

- Ajax refresh of the logs

- Quick [column navigation](https://issues.cloudera.org/browse/HUE-899) on the result page

- MapReduce jobs listing with a direct access to their logs

- ‘Email me on completion’ setting

- [Multi-database](https://issues.cloudera.org/browse/HUE-535) support


Example of the screen while running query:

[![](http://blog.cloudera.com/wp-content/uploads/2013/03/hue9.png)
](http://blog.cloudera.com/wp-content/uploads/2013/03/hue9.png)

Seeing the result of the query:

[![](http://blog.cloudera.com/wp-content/uploads/2013/03/hue10.png)
](http://blog.cloudera.com/wp-content/uploads/2013/03/hue10.png)

Note: if your queries are failing and you are seeing an error like below, it means that you forgot to add the ‘/user/flume/hive-serdes-1.0-SNAPSHOT.jar’ to the query:







||FAILED: Execution Error, return code 2 from org.apache.hadoop.hive.ql.exec.MapRedTask|


 

## Conclusion

In this post we focused on how the Beeswax application can make it easy to execute Hive queries. New features such as multi-query ([HUE-159](https://issues.cloudera.org//browse/HUE-159)), autocomplete, and syntax highlighting ([HUE-1063](https://issues.cloudera.org/browse/HUE-1063)) are going to improve the usability even more.

The next article in this series will elaborate on this topic and describe how Hue’s Apache Oozie application can be used for scheduling Hive queries in a few clicks.

Thank you for reading and feel free to post comments here or on the [hue-user](https://groups.google.com/a/cloudera.org/group/hue-user/topics) list. We also hope to see you at the first [Hue meetup](http://www.meetup.com/San-Francisco-Bay-Area-Hue-Users) (this Wednesday, March 27)!

*Romain Rigaux is a Software Engineer on the Platform team*.
![](http://blog.cloudera.com/wp-content/plugins/social-media-feather/synved-social/image/social/regular/32x32/facebook.png)

![](http://blog.cloudera.com/wp-content/plugins/social-media-feather/synved-social/image/social/regular/32x32/google_plus.png)

![](http://blog.cloudera.com/wp-content/plugins/social-media-feather/synved-social/image/social/regular/32x32/linkedin.png)

![](http://blog.cloudera.com/wp-content/plugins/social-media-feather/synved-social/image/social/regular/32x32/mail.png)

![](http://blog.cloudera.com/wp-content/plugins/social-media-feather/synved-social/image/social/regular/64x64/facebook.png)

![](http://blog.cloudera.com/wp-content/plugins/social-media-feather/synved-social/image/social/regular/64x64/google_plus.png)

![](http://blog.cloudera.com/wp-content/plugins/social-media-feather/synved-social/image/social/regular/64x64/linkedin.png)

![](http://blog.cloudera.com/wp-content/plugins/social-media-feather/synved-social/image/social/regular/64x64/mail.png)

